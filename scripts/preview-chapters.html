<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter Preview - MarketHawk</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #0f0f0f;
      color: #fff;
    }
    h1 { margin-bottom: 5px; }
    .subtitle { color: #aaa; margin-bottom: 30px; }

    .container {
      max-width: 1280px;
      margin: 0 auto;
    }

    video {
      width: 100%;
      background: #000;
      border-radius: 8px;
    }

    .description {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .description h2 {
      margin-top: 0;
      color: #00c805;
    }

    .description pre {
      background: #0a0a0a;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .timestamp {
      color: #3ea6ff;
      cursor: pointer;
      text-decoration: none;
    }

    .timestamp:hover {
      text-decoration: underline;
    }

    .thumbnails {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .thumbnails h2 {
      margin-top: 0;
      color: #00c805;
    }

    .thumbnail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .thumbnail-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .thumbnail-item:hover {
      transform: scale(1.05);
    }

    .thumbnail-item img {
      width: 100%;
      height: auto;
      display: block;
    }

    .thumbnail-label {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.8);
      padding: 8px;
      text-align: center;
      font-size: 14px;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1 id="title">Loading...</h1>
  <div class="subtitle" id="subtitle">Earnings Call Preview</div>

  <div class="container">
    <video id="video" controls>
      <source id="videoSource" src="" type="video/mp4">
      Your browser does not support the video tag.
    </video>

    <div class="thumbnails">
      <h2>Thumbnails</h2>
      <div class="thumbnail-grid" id="thumbnailGrid"></div>
    </div>

    <div class="description">
      <h2>Description</h2>
      <div id="descriptionText"></div>
    </div>
  </div>

  <script>
    // CONFIGURATION - Edit these values
    const CONFIG = {
      ticker: 'HOOD',
      quarter: 'Q3-2025',
      // Use rendered video (change to 'take1', 'take2', etc. as needed)
      videoType: 'take1', // or 'input/source.trimmed' for original
      videoFilename: 'final.mp4', // Actual rendered filename
      serverUrl: 'http://192.168.1.101:8080'
    };

    const video = document.getElementById('video');
    const videoSource = document.getElementById('videoSource');

    // Load rendered video with enhancements
    const httpVideoPath = `${CONFIG.serverUrl}/${CONFIG.ticker}/${CONFIG.quarter}/${CONFIG.videoType}/${CONFIG.videoFilename}`;
    videoSource.src = httpVideoPath;
    video.load();

    console.log('Loading video from:', httpVideoPath);

    // Load insights.json
    fetch(`${CONFIG.serverUrl}/${CONFIG.ticker}/${CONFIG.quarter}/insights.json`)
      .then(res => res.json())
      .then(data => {
        const metadata = data.metadata || {};
        const chapters = data.chapters || [];

        // Update title
        document.getElementById('title').textContent =
          `${metadata.company} ${metadata.quarter} ${metadata.year} Earnings Call`;

        // Generate YouTube description with clickable timestamps
        let description = `${metadata.summary || ''}<br><br>`;
        description += `ðŸ“– Chapters:<br>`;
        chapters.forEach(ch => {
          const timestamp = formatTime(ch.timestamp);
          description += `<a class="timestamp" data-time="${ch.timestamp}">${timestamp}</a> - ${ch.title}<br>`;
        });
        description += `<br>ðŸ“Š Full interactive analysis: https://markethawkeye.com/${metadata.ticker || 'unknown'}/${metadata.quarter || 'q4'}-${metadata.year || 2024}<br>`;
        description += `<br>Subscribe for more earnings call visualizations!<br><br>`;

        // Add hashtags
        if (data.youtube && data.youtube.hashtags) {
          description += `${data.youtube.hashtags.map(h => '#' + h).join(' ')}`;
        }

        document.getElementById('descriptionText').innerHTML = description;

        // Make timestamps clickable
        document.querySelectorAll('.timestamp').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const time = parseFloat(link.getAttribute('data-time'));
            video.currentTime = time;
            video.play();
          });
        });

        // Load thumbnails
        const thumbnailGrid = document.getElementById('thumbnailGrid');
        for (let i = 1; i <= 4; i++) {
          const thumbnailUrl = `${CONFIG.serverUrl}/${CONFIG.ticker}/${CONFIG.quarter}/thumbnail_${i}.jpg`;

          const item = document.createElement('div');
          item.className = 'thumbnail-item';
          item.innerHTML = `
            <img src="${thumbnailUrl}" alt="Thumbnail ${i}">
            <div class="thumbnail-label">Thumbnail ${i}</div>
          `;

          // Click to download
          item.onclick = () => {
            const a = document.createElement('a');
            a.href = thumbnailUrl;
            a.download = `${CONFIG.ticker}-${CONFIG.quarter}-thumbnail-${i}.jpg`;
            a.click();
          };

          thumbnailGrid.appendChild(item);
        }
      })
      .catch(err => {
        console.error('Error loading insights:', err);
        alert('Error loading insights.json. Make sure HTTP server is running:\n\ncd /var/markethawk && python3 -m http.server 8080');
      });

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
  </script>
</body>
</html>
